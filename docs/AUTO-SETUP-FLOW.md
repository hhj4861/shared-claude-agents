# 자동 프로젝트 설정 플로우

이 문서는 shared-claude-agents의 자동화 시스템이 어떻게 동작하는지 설명합니다.

---

## 설치 옵션

| 옵션 | 명령 | 용도 |
|------|------|------|
| **Quick Install** | `./quick-install.sh` | 최소 설치 (hook만 설정) |
| **Full Install** | `./install.sh` | 전체 설치 (MCP 서버 포함) |

### Quick Install vs Full Install

```
┌─────────────────────────────────────────────────────────────┐
│                    Quick Install                            │
├─────────────────────────────────────────────────────────────┤
│  ✓ SessionStart hook 설정                                   │
│  ✓ shared-agents 심볼릭 링크                                │
│  ✗ MCP 서버 빌드/등록 안 함                                 │
│  ✗ 권한 설정 안 함                                          │
│                                                             │
│  → 프로젝트 분석, 에이전트 생성은 가능                      │
│  → MCP 필요 시 install.sh 추가 실행                         │
└─────────────────────────────────────────────────────────────┘

┌─────────────────────────────────────────────────────────────┐
│                    Full Install                             │
├─────────────────────────────────────────────────────────────┤
│  ✓ SessionStart hook 설정                                   │
│  ✓ shared-agents 심볼릭 링크                                │
│  ✓ MCP 서버 빌드/등록 (playwright, swagger, figma 등)       │
│  ✓ 권한 설정 (MCP 도구 자동 승인)                           │
│                                                             │
│  → 모든 기능 사용 가능                                      │
└─────────────────────────────────────────────────────────────┘
```

---

## 자동화 플로우 (Quick Install 후)

### Phase 1: 설치 (1회만)

```
┌─────────────────────────────────────────────────────────────┐
│  사용자 액션: ./quick-install.sh                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  1. ~/.claude/shared-agents 심볼릭 링크 생성                │
│     → 레포 위치를 표준 경로로 연결                          │
│                                                             │
│  2. ~/.claude/settings.json에 SessionStart hook 등록        │
│     → auto-project-setup.sh가 매 세션 시작 시 실행됨        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ✅ 설치 완료 (이후 자동)
```

### Phase 2: 프로젝트 진입 (자동)

```
┌─────────────────────────────────────────────────────────────┐
│  사용자 액션: cd /path/to/project && claude                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  SessionStart Hook 실행 (자동)                              │
│  → scripts/auto-project-setup.sh                            │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  auto-project-setup.sh 동작:                                │
│                                                             │
│  1. shared-agents 최신화 (git pull)                         │
│                                                             │
│  2. 프로젝트 루트 감지                                      │
│     - .git, package.json, build.gradle 등 확인              │
│     - 프로젝트 아니면 종료                                  │
│                                                             │
│  3. .claude/ 디렉토리 자동 생성                             │
│     - .claude/project-agents/ (동적 에이전트용)             │
│     - docs/plans/ (구현 계획용)                             │
│                                                             │
│  4. 심볼릭 링크 설정 (없는 것만)                            │
│     - .claude/agents → shared-agents/agents                 │
│     - .claude/skills → shared-agents/skills                 │
│     - .claude/scripts → shared-agents/scripts               │
│     - .claude/standards → shared-agents/standards           │
│     - .claude/RULES.md → shared-agents/RULES.md             │
│                                                             │
│  5. hooks 디렉토리 복사 (없으면)                            │
│     - templates/.claude/hooks/ → .claude/hooks/             │
│                                                             │
│  6. settings.json 복사 (없으면)                             │
│                                                             │
│  7. CLAUDE.md 심볼릭 링크 (없으면)                          │
│     → templates/CLAUDE.project.md                           │
│                                                             │
│  8. 상태 메시지 출력                                        │
│     - 컨텍스트 없으면: "프로젝트 분석해줘" 안내             │
│     - 컨텍스트 있으면: 로드 상태 표시                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
            ✅ 프로젝트 환경 설정 완료 (자동)
```

### Phase 3: 프로젝트 분석 (첫 세션)

```
┌─────────────────────────────────────────────────────────────┐
│  콘솔 출력:                                                 │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│    📋 프로젝트 컨텍스트가 없습니다                          │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━ │
│    "프로젝트 분석해줘" 라고 말씀하세요.                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  사용자 액션: 아무 말이나 입력 (예: "안녕")                 │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  Claude가 CLAUDE.md 읽음                                    │
│  → .claude/project-context.md 존재 확인                     │
│  → 없으면 자동으로 project-profiler 실행                    │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  project-profiler 에이전트 실행:                            │
│                                                             │
│  Phase 1: 프로젝트 정체성 (WHY)                             │
│     - README.md, CLAUDE.md, package.json 분석               │
│     - 프로젝트 목적 파악                                    │
│                                                             │
│  Phase 2: 현재 상태 (WHAT)                                  │
│     - 디렉토리 구조, Git 히스토리                           │
│     - TODO/FIXME 검색                                       │
│                                                             │
│  Phase 3: 기술 아키텍처 (HOW)                               │
│     - 프레임워크, 패턴 감지                                 │
│     - 의존성 분석                                           │
│                                                             │
│  Phase 4: 도메인 모델 (DOMAIN)                              │
│     - 엔티티, 비즈니스 로직 추출                            │
│                                                             │
│  Phase 5: 문제점 식별 (GAPS)                                │
│     - 기술 부채, 테스트 상태                                │
│                                                             │
│  Phase 6: 에이전트 추천 (AGENTS)                            │
│     - 적합한 에이전트 판단                                  │
│     - 동적 에이전트 생성 필요 여부                          │
│                                                             │
│  Phase 7: MCP 분석 (MCP)                                    │
│     - 필요한 MCP 서버 파악                                  │
│     - 설치 상태 확인                                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  산출물:                                                    │
│                                                             │
│  .claude/project-context.md                                 │
│     - 프로젝트 이해 문서                                    │
│     - 기술 스택, 도메인, 문제점                             │
│     - 추천 에이전트 목록                                    │
│     - MCP 요구사항                                          │
│                                                             │
│  .claude/agent-registry.json                                │
│     - 에이전트 매핑 및 라우팅 규칙                          │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  agent-generator 에이전트 실행 (필요시):                    │
│                                                             │
│  - 프로젝트 전용 에이전트 동적 생성                         │
│  - .claude/project-agents/ 에 저장                          │
│                                                             │
│  예시:                                                      │
│     payment-tester.md (결제 도메인 전용)                    │
│     order-validator.md (주문 상태 검증)                     │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
              ✅ 프로젝트 분석 완료 (이후 자동 로드)
```

### Phase 4: 이후 세션 (완전 자동)

```
┌─────────────────────────────────────────────────────────────┐
│  사용자 액션: claude                                        │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  SessionStart Hook → auto-project-setup.sh                  │
│  → 설정 확인 (이미 있으면 스킵)                             │
│  → 컨텍스트 로드 상태 표시                                  │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│  콘솔 출력:                                                 │
│  ✓ 프로젝트 컨텍스트 로드됨 (분석: 2025-01-17)              │
│  ✓ 프로젝트 전용 에이전트: 2개                              │
└─────────────────────────────────────────────────────────────┘
                              │
                              ▼
                    ✅ 바로 작업 시작 가능
```

---

## 파일 구조

```
~/.claude/
├── settings.json              ← SessionStart hook 등록됨
├── shared-agents/             ← 심볼릭 링크 (레포 위치)
│   ├── agents/                ← 공통 에이전트
│   ├── skills/                ← 스킬
│   ├── scripts/
│   │   └── auto-project-setup.sh  ← hook에서 실행
│   ├── templates/
│   │   ├── CLAUDE.project.md      ← 프로젝트 CLAUDE.md 템플릿
│   │   ├── project-context.template.md
│   │   └── .claude/
│   │       ├── hooks/
│   │       └── settings.json
│   ├── quick-install.sh       ← 최소 설치
│   └── install.sh             ← 전체 설치
└── agents/                    ← 심볼릭 링크 (공통 에이전트)

프로젝트/
├── .claude/
│   ├── agents/                ← 심볼릭 링크
│   ├── skills/                ← 심볼릭 링크
│   ├── scripts/               ← 심볼릭 링크
│   ├── project-agents/        ← 동적 생성 에이전트
│   ├── project-context.md     ← 프로젝트 분석 결과
│   ├── agent-registry.json    ← 에이전트 매핑
│   ├── hooks/                 ← 복사됨
│   └── settings.json          ← 복사됨
├── docs/
│   └── plans/                 ← 구현 계획
└── CLAUDE.md                  ← 심볼릭 링크
```

---

## 자동화 범위 요약

| 항목 | 자동화 | 비고 |
|------|--------|------|
| quick-install.sh 실행 | ❌ 수동 | **1회만** |
| 프로젝트 환경 설정 | ✅ 자동 | hook에서 처리 |
| 프로젝트 분석 트리거 | ⚠️ 반자동 | 사용자 첫 입력 필요 |
| 프로젝트 분석 실행 | ✅ 자동 | CLAUDE.md 지시 |
| 동적 에이전트 생성 | ✅ 자동 | 분석 후 실행 |
| 이후 세션 컨텍스트 로드 | ✅ 자동 | hook + CLAUDE.md |

---

## 재분석 / 갱신

```yaml
수동_재분석:
  트리거: "프로젝트 다시 분석해줘" 또는 "/profile --force"
  동작: 기존 컨텍스트 덮어쓰기

자동_갱신:
  조건: Phase 5 (증분 학습) 구현 후
  동작: 세션 중 학습 내용 자동 반영 (예정)
```

---

## 문제 해결

### Hook이 실행 안 될 때

```bash
# settings.json 확인
cat ~/.claude/settings.json | jq '.hooks'

# hook이 없으면 다시 설치
./quick-install.sh
```

### 프로젝트 설정이 안 될 때

```bash
# 프로젝트 루트 확인 (다음 중 하나 필요)
ls -la .git package.json build.gradle pyproject.toml

# 수동 설정
./install.sh /path/to/project
```

### 분석이 자동 시작 안 될 때

```bash
# CLAUDE.md 확인
ls -la CLAUDE.md

# 심볼릭 링크가 아니면 다시 연결
ln -sf ~/.claude/shared-agents/templates/CLAUDE.project.md CLAUDE.md
```
